<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>OfficeHoursOnline Room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-signin-client_id" content="144888334346-q2reo5jb44s0ges19r5ikpggq5f014qh.apps.googleusercontent.com">
  <script src="https://static.opentok.com/v2/js/opentok.js" charset="utf-8"></script>
  <script>
    var obj = {};
    var email = localStorage.getItem("email");
    obj.email = String(email);

    function handleRole(event) {
      var role = event.target.dataset.message;
      obj.role = role;
      console.log('Signed in as: ' + email);
      console.log('role: ' + role);

      if (role == "prof") {
        //code below not sending data to server right, email not appearing in web server console
       /* var xhr = new XMLHttpRequest();
        var response = {};
        xhr.open('GET', '/room/' + email.substr(0, email.indexOf('@')));
        xhr.setRequestHeader("Content-Type", "application/json", "charset=utf-8");
        xhr.send(null);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == XMLHttpRequest.DONE) {
            response.apiKey = xhr.responseText.apiKey;
            response.sessionId = xhr.responseText.sessionId;
            response.token = xhr.responseText.token;
          }
        }*/
        window.location.replace('/room/' + email.substr(0, email.indexOf('@')));

      } else {
        var profEmail = prompt("Please enter your professor's email", "example@ucsc.edu");
        while (profEmail == "example@ucsc.edu") {
          var profEmail = prompt("Please enter your professor's email", "example@ucsc.edu");
        }
        var student = {};
        student.name = email.substr(0, email.indexOf('@'));
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/room/' + profEmail.substr(0, profEmail.indexOf('@')) + '/' + student.name);
        xhr.setRequestHeader("Content-Type", "application/json", "charset=utf-8");
        xhr.send(null);

      }

      console.log("after send");
    }
  </script>
</head>

<body>
  <p>logged in as
    <span id="email"></span>
  </p>
  <a href="#" data-message="prof" onclick="handleRole(event);">Professor</a>
  <br>
  <a href="#" data-message="stud" onclick="handleRole(event);">Student</a>
  
  <!--google signout code-->
  <br>
  <a href="/">Switch accounts/log out</a>

  <script>
    document.getElementById("email").innerHTML = localStorage.getItem("email");
  </script>

  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <!-- <script src="../js/room.js"></script> -->
</body>

</html>